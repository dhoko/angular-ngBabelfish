angular.module("ngBabelfish",[]).run(["$rootScope","marvin","babelfishLang",function(n,a,e){e.init(),n.$on(a.getRouteEvent(),function(n,a){e.bindForState(a.name)})}]),angular.module("ngBabelfish").directive("i18nBind",["marvin","babelfish",function(n,a){"use strict";return{link:function(e,t,r){var i=r.i18nBind,o=r.i18nBindLang||n.getDefaultLang();if(a.isLangLoaded(o)){var u=a.get(o);return t.text(u[i])}a.current()!==o&&a.load(o),a.on("change:language",function(n){if(a.isLangLoaded(n.lang)&&!r.i18nBindLang){var e=a.get(n.lang);t.text(e[i])}}),a.on("load:language",function(n){var e=a.get(n.lang);t.text(e[i])})}}}]),angular.module("ngBabelfish").directive("i18nLoad",["babelfish",function(n){"use strict";return{link:function(a,e,t){e.on("click",function(){a.$apply(function(){n.updateLang(t.i18nLoad)})})}}}]),angular.module("ngBabelfish").factory("babelfishEvent",["$rootScope",function(n){"use strict";function a(n,a){(e[n]||[]).forEach(function(n){n(a)})}var e={};return n.$on("ngBabelfish.translation:loaded",function(n,e){e.previousLang!==e.lang&&a("change:language",e)}),n.$on("ngBabelfish.lang:loaded",function(n,e){a("load:language",e)}),{set:function(n,a){e[n]=e[n]||[],e[n].push(a||angular.noop)}}}]),angular.module("ngBabelfish").factory("marvinMemory",function(){"use strict";var n={state:{current:"",previous:"",loaded:!1},lang:{previous:"en-EN",current:"en-EN"},data:null,available:[]};return{get:function(){return n},set:function(a){angular.extend(n,a)}}}),angular.module("ngBabelfish").filter("translate",["babelfish",function(n){"use strict";function a(a,e){return n.get(e)[a]}return a.$stateful=!0,a}]),angular.module("ngBabelfish").provider("marvin",function(){"use strict";var n={state:"home",lang:"en-EN",url:"/i18n/languages.json",routeEventName:"$stateChangeSuccess",namespace:"i18n",lazy:!1,lazyConfig:[],current:"",log:!0,bindToScope:!0};this.init=function(a){return angular.extend(n,a),this},this.lang=function(a){if(!a.lang)throw new Error("[marvinProvider@lang] You must set the key lang");if(!a.url)throw new Error("[marvinProvider@lang] You must set the key url");return n.lazy=!0,n.lazyConfig.push(a),this},this.bindToScope=function(a){return n.bindToScope=a,this},this.verbose=function(a){return n.log=a,this},this.routingEvent=function(a){return n.routeEventName=a,this},this.$get=function(){return{getConfig:function(){return n},getRouteEvent:function(){return n.routeEventName},getNamespace:function(){return n.namespace},getDefaultLang:function(){return n.lang?(document.documentElement.lang=n.lang.split("-")[0],n.lang):document.documentElement.lang+"-"+document.documentElement.lang.toUpperCase()},getLazyLangAvailable:function(){return n.lazyConfig.map(function(n){return n.lang})},getLazyConfig:function(a){var e=a||this.getDefaultLang();return n.lazyConfig.filter(function(n){return n.lang===e})[0]||{}},getLazyConfigByUrl:function(a){return n.lazyConfig.filter(function(n){return n.url===a})[0]},isVerbose:function(){return n.log},isLazy:function(){return n.lazy},isBindToScope:function(){return n.bindToScope}}}}),angular.module("ngBabelfish").service("babelfish",["marvin","marvinMemory","babelfishLang","marvinTasks","babelfishEvent",function(n,a,e,t,r){"use strict";function i(a){var e=d.data[a||d.lang.current]||{},t={};return e[d.state.current]||(n.isVerbose()&&console.warn("[ngBabelfish.babelfish@get] No translation available for the page %s for the lang %s",d.state.current,a||d.lang.current),e[d.state.current]={}),angular.extend(t,{},e._common),angular.extend(t,e[d.state.current])}function o(n){return d.data[n||d.lang.current]}function u(){return d.data}function l(n){return!!d.data&&!!d.data[n]}function s(){return d.lang.current}function g(){return d.available.indexOf("_common")>-1&&d.available.splice(d.available.indexOf("_common"),1),d.available}function c(n){e.set(n,t.bindToScope)}function f(a){var t=n.getLazyConfig(a);e.load(t.url,a)}var d=a.get();return{get:i,all:o,current:s,translations:u,languages:g,isLangLoaded:l,updateLang:c,load:f,on:r.set}}]),angular.module("ngBabelfish").service("babelfishLang",["$http","$rootScope","marvin","marvinMemory","marvinTasks",function(n,a,e,t,r){"use strict";function i(n,a){u(n),s(a).then(e.isBindToScope()?r.bindToScope:angular.noop)}function o(n){u(n),e.isBindToScope()&&r.bindToScope(n)}function u(n){c.state.current=n}function l(n,e){e=e||angular.noop,c.lang.previous=angular.copy(c.lang.current),c.lang.current=n,a.$emit("ngBabelfish.lang:setLanguage",c.lang),e()}function s(a,t){return a=a||e.getConfig().url,e.isLazy()&&!t&&(a=e.getLazyConfig(c.lang.current||e.getConfig().lang).url),n.get(a).error(function(){if(e.isVerbose())throw new Error("[ngBabelfish.babelfishLang@load] Cannot load the translation file")}).success(function(n){g(n,t)})}function g(n,t){t=t||c.lang.current,e.isLazy()?(c.data=c.data||{},c.data[t]=n,-1===c.available.indexOf(t)&&c.available.push(t)):(c.data=n,c.available=Object.keys(n)),a.$emit("ngBabelfish.lang:loaded",{lang:t})}var c=t.get();a.$on("ngBabelfish.marvin:requestTranslation",function(n,a){i(a.state,a.url)}),this.init=i,this.load=s,this.translate=g,this.set=l,this.bindForState=o,this.setState=u}]),angular.module("ngBabelfish").service("marvinTasks",["$rootScope","marvin","marvinMemory",function(n,a,e){"use strict";function t(){var e=i.lang.current;return a.isLazy()&&!i.data[e]?void n.$emit("ngBabelfish.marvin:requestTranslation",{state:i.state.current,url:a.getLazyConfig(e).url}):void r()}function r(){var e,t=i.lang.current,r=i.state.current,o={};(r!==i.state.previous||i.lang.current!==i.lang.previous)&&i.data[t]&&(e=i.data[t][r],e||(i.data[t][r]={},a.isVerbose()&&console.warn("[ngBabelfish.marvinTasks@setTranslation] No translation available for the page %s for the lang %s",r,t)),angular.extend(o,angular.extend({},i.data[t]._common),e),a.isBindToScope()&&(a.getNamespace()?n[a.getNamespace()]=o:(angular.extend(n,o),a.isVerbose()&&console.warn("[ngBabelfish.marvinTasks@setTranslation] It is better to Load i18n inside a namespace."))),n.$emit("ngBabelfish.translation:loaded",{currentState:r,lang:t,previousLang:i.lang.previous}))}var i=e.get();this.bindToScope=t,this.setTranslation=r}]);